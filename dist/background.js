(()=>{"use strict";var e,t,o,r,a={51:(e,t,o)=>{o.a(e,(async(e,t)=>{try{chrome.action.onClicked.addListener((e=>{"number"==typeof e.id&&chrome.tabs.sendMessage(e.id,{type:"getTextQuoteSelectorfromSelection"})}));const e=await fetch("https://scrapbox.io/api/projects/anno");if(!e.ok)throw new Error(`Failed to fetch project: ${e.status}`);const{image:o}=await e.json(),r=new Map;chrome.runtime.onMessage.addListener((async(e,t)=>{if("ready"===e.type){if("number"!=typeof t.tab?.id)return;const a=await fetch(`https://scrapbox.io/api/pages/anno/${encodeURIComponent(e.url)}`);if(!a.ok)throw new Error(`Failed to fetch page: ${a.status}`);const n=await a.json(),s=[];for(const t of n.lines)for(const a of t.text.matchAll(/\[.*?\s(.*?)\]/g)){let n;try{n=new URLSearchParams(new URL(a[1]).hash)}catch{continue}const c=n.get("e");if(!c)continue;let i=t.text;for(const e of i.matchAll(/\[([^\[\]]+\.icon)\*([1-9]\d*)\]/g))i=i.replace(e[0],`[${e[1]}]`.repeat(Number(e[2])));const p=[];for(const e of i.matchAll(/\[([^\[\]]+)\.icon\]/g)){const t=e[1];let o=r.get(t);if(!o){const e=await fetch(`https://scrapbox.io/api/pages/anno/${encodeURIComponent(t)}`);if(!e.ok)throw new Error(`Failed to fetch iconAPI: ${e.status}`);const{image:a}=await e.json();r.set(t,a),o=a}p.push(o)}p.length||p.push(o);const f={textQuoteSelector:{prefix:n.get("p")??void 0,exact:c,suffix:n.get("s")??void 0},url:`https://scrapbox.io/anno/${encodeURIComponent(e.url)}#${t.id}`,iconImageURLs:p};s.push(f)}const c={type:"inject",configs:s};chrome.tabs.sendMessage(t.tab.id,c)}})),t()}catch(e){t(e)}}),1)}},n={};function s(e){var t=n[e];if(void 0!==t)return t.exports;var o=n[e]={exports:{}};return a[e](o,o.exports,s),o.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",o="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",r=e=>{e&&!e.d&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},s.a=(a,n,s)=>{var c;s&&((c=[]).d=1);var i,p,f,h=new Set,u=a.exports,d=new Promise(((e,t)=>{f=t,p=e}));d[t]=u,d[e]=e=>(c&&e(c),h.forEach(e),d.catch((e=>{}))),a.exports=d,n((a=>{var n;i=(a=>a.map((a=>{if(null!==a&&"object"==typeof a){if(a[e])return a;if(a.then){var n=[];n.d=0,a.then((e=>{s[t]=e,r(n)}),(e=>{s[o]=e,r(n)}));var s={};return s[e]=e=>e(n),s}}var c={};return c[e]=e=>{},c[t]=a,c})))(a);var s=()=>i.map((e=>{if(e[o])throw e[o];return e[t]})),p=new Promise((t=>{(n=()=>t(s)).r=0;var o=e=>e!==c&&!h.has(e)&&(h.add(e),e&&!e.d&&(n.r++,e.push(n)));i.map((t=>t[e](o)))}));return n.r?p:s()}),(e=>(e?f(d[o]=e):p(u),r(c)))),c&&(c.d=0)},s(51)})();