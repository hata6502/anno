(()=>{"use strict";var e,t,o,r,n={51:(e,t,o)=>{o.a(e,(async(e,t)=>{try{chrome.action.onClicked.addListener((e=>{"number"==typeof e.id&&chrome.tabs.sendMessage(e.id,{type:"getTextQuoteSelectorfromSelection"})}));const e=await fetch("https://scrapbox.io/api/projects/anno");if(!e.ok)throw new Error(`Failed to fetch project: ${e.status}`);const{image:o}=await e.json(),r=new Map;chrome.runtime.onMessage.addListener((async(e,t)=>{if("ready"===e.type){if("number"!=typeof t.tab?.id)return;const n=await fetch(`https://scrapbox.io/api/pages/anno/${encodeURIComponent(e.url)}`);if(!n.ok)throw new Error(`Failed to fetch page: ${n.status}`);const a=await n.json(),s=[];let c=[];for(const e of a.lines.slice(1))e.text?c.push(e):(s.push(c),c=[]);s.push(c);const i=[];for(const t of s)if(t.length)for(const n of t[0].text.matchAll(/\[.*?\s(.*?)\]/g)){let a;try{a=new URLSearchParams(new URL(n[1]).hash)}catch{continue}const s=a.get("e");if(!s)continue;let c=t[0].text;for(const e of c.matchAll(/\[([^\[\]]+\.icon)\*([1-9]\d*)\]/g))c=c.replace(e[0],`[${e[1]}]`.repeat(Number(e[2])));const p=[];for(const e of c.matchAll(/\[([^\[\]]+)\.icon\]/g)){const t=e[1];let o=r.get(t);if(!o){const e=await fetch(`https://scrapbox.io/api/pages/anno/${encodeURIComponent(t)}`);if(!e.ok)throw new Error(`Failed to fetch iconAPI: ${e.status}`);const{image:n}=await e.json();r.set(t,n),o=n}p.push(o)}p.length||p.push(o);const f={textQuoteSelector:{prefix:a.get("p")??void 0,exact:s,suffix:a.get("s")??void 0},url:`https://scrapbox.io/anno/${encodeURIComponent(e.url)}#${t[0].id}`,description:t.slice(1).map((({text:e})=>e)).join("\n"),iconImageURLs:p};i.push(f)}const p={type:"inject",configs:i};chrome.tabs.sendMessage(t.tab.id,p)}})),t()}catch(e){t(e)}}),1)}},a={};function s(e){var t=a[e];if(void 0!==t)return t.exports;var o=a[e]={exports:{}};return n[e](o,o.exports,s),o.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",o="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",r=e=>{e&&!e.d&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},s.a=(n,a,s)=>{var c;s&&((c=[]).d=1);var i,p,f,h=new Set,u=n.exports,l=new Promise(((e,t)=>{f=t,p=e}));l[t]=u,l[e]=e=>(c&&e(c),h.forEach(e),l.catch((e=>{}))),n.exports=l,a((n=>{var a;i=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[e])return n;if(n.then){var a=[];a.d=0,n.then((e=>{s[t]=e,r(a)}),(e=>{s[o]=e,r(a)}));var s={};return s[e]=e=>e(a),s}}var c={};return c[e]=e=>{},c[t]=n,c})))(n);var s=()=>i.map((e=>{if(e[o])throw e[o];return e[t]})),p=new Promise((t=>{(a=()=>t(s)).r=0;var o=e=>e!==c&&!h.has(e)&&(h.add(e),e&&!e.d&&(a.r++,e.push(a)));i.map((t=>t[e](o)))}));return a.r?p:s()}),(e=>(e?f(l[o]=e):p(u),r(c)))),c&&(c.d=0)},s(51)})();